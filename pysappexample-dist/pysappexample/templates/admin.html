<% set user_message_html = process_view('apputil:UserMessagesSnippet') -%>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />    
    <base href="<{ index_url(True) }>" />
    <title>
        <% block title %><{ settings.name.short|title }> Control Panel<% endblock %>
    </title>
    
    <style type="text/css">
    /*<![CDATA[*/
        @import "<{ style_url('default.css')}>";
        @import "<{ style_url('admin_template.css')}>";
        @import "wymeditor/skins/default/screen.css";
        .wym_skin_default {
            font-size:1em;
        }
        
        <{ page_css() }>
    /*]]>*/
    </style>
    
    <script type="text/javascript" src="<{ js_url('jquery-etal.js', app='rcsappbase')}>"></script>
    <script type="text/javascript" src="wymeditor/jquery.wymeditor.pack.js"></script>
    <script type="text/javascript">
    /*<![CDATA[             */
        <{ page_js() }>
        
        function convert_to_wyme(selector){            
            jQuery(selector).wymeditor({
                wymPath: "<{ index_url(True) }>wymeditor/jquery.wymeditor.pack.js",
                postInit: function(wym) {
                    //render the containers box as a panel
                    //and remove the span containing the '>'
                    jQuery(wym._box).find(wym._options.containersSelector)
                        .removeClass('wym_dropdown')
                        .addClass('wym_panel')
                        .find('h2 > span')
                        .remove();
                    //adjust the editor's height
                    jQuery(wym._box).find(wym._options.iframeSelector)
                        .css('height', '250px');
                }
            }
            );
            // give the wymeditors some room
            jQuery(selector).each(function(i){
                var fw = $(this).parents('div.field-wrapper:eq(0)');
                var label = $(this).parents('div.row:eq(0)').find('label');
                fw.css('display', 'block');
                fw.css('float', 'none');
                label.css('float', 'none');
            });
        }
    
    /*]]>          */
    </script>
</head>
<body>
    <div id="page_wrapper">
        <div id="page_header">
            <h1><a href="<{ index_url() }>"><{ settings.name.full|title }> Control Panel</a></h1>
        </div>
        <ul id="top_nav">
            <li><a href="<{ index_url() }>">Home</a> | </li>
            <% if sesuser.is_authenticated() %>
            <li><a href="<{ url_for('apputil:DynamicControlPanel')}>">Control Panel</a> | </li>
            <li><a href="<{ url_for('users:ChangePassword')}>">Change Password</a> | </li>
            <li><a href="<{ url_for('users:Logout') }>">Logout</a></li>
            <% else %>
            <li><a href="<{ url_for('users:Login') }>">Login</a></li>
            <% endif %>
            
        </ul>
        <div id="page_body">
            <div id="page_content">    

                <{ user_message_html }>
                
                <% block body %><% endblock %>
            </div>
        </div>
        
        <div id="page_footer">
            <p>&nbsp;</p>
        </div>
    </div>
    <p class="credits"><strong><a class="blended" href="http://www.rcsws.com">Web Design</a></strong> &amp; <strong><a class="blended" href="http://www.rcsws.com">Web Development</a></strong> by <strong><a href="http://www.rcsws.com/">RCS Web Solutions</a></strong></p>
    
    <div id="session_controls">
        <#{if $pUserIsAuthenticated == true }>
            <p>Welcome, <strong><{$pUserName}></strong>. <a href="<{pGenURL view='Users-Logout'}>">Logout</a>.</p>
        <{else}>
            <p><a href="<{pGenURL module='users' view='login'}>">Login</a></p>
        <{/if}>
        <{if "programmer"|pUserHasAuthlevel }>
            <p>performance: <<page_performance>></p>
        <{/if}#> 
    </div>
</body>
</html>
